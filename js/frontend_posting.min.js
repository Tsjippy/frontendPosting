(()=>{var e={298:()=>{function e(e){e.stopImmediatePropagation();var t=e.target,n=t.closest("form"),o=t.options[t.selectedIndex],l=o.value,a=o.text;"modal"==l?Main.showModal("add_location"):""!=a&&(n.querySelector("[name='location[address]']").value=a+" State",n.querySelector("[name='location[latitude]']").value=locations.locations[l].lat,n.querySelector("[name='location[longitude]']").value=locations.locations[l].lon)}console.log("Location.js loaded"),document.addEventListener("DOMContentLoaded",(function(){!function(){if(null==document.getElementById("googlemaps")&&"object"==typeof mapsApi&&"undefined"!=typeof initMap){const e=document.createElement("script");e.id="googlemaps",e.src=`//maps.googleapis.com/maps/api/js?key=${mapsApi.key}&callback=initMap`,e.async=!0,e.loading="async",document.body.append(e)}}();let t=document.querySelector('[name="location[preset]"]');void 0!==t&&null!=t&&t.addEventListener("change",e),t=document.querySelector(".latitude"),void 0!==t&&null!=t&&t.addEventListener("keydown",o),t=document.querySelector(".longitude"),void 0!==t&&null!=t&&t.addEventListener("keydown",o);var n=null;function o(){clearTimeout(n),n=setTimeout(l,1e3)}function l(){var e=document.querySelector(".latitude").value,t=document.querySelector(".longitude").value,n=new google.maps.Geocoder;if(""!=e&&""!=t){var o={lat:parseFloat(e),lng:parseFloat(t)};n.geocode({location:o},(function(e,t){"OK"===t&&e[0]&&document.querySelectorAll(".address").forEach((function(t){""==t.value&&(t.value=e[0].formatted_address)}))}))}}function a(e){var t=new google.maps.Geocoder,n=e.target.value;t.geocode({address:n},(function(e,t){"OK"===t&&(document.querySelectorAll(".latitude").forEach((function(t){t.value=e[0].geometry.location.lat().toFixed(7)})),document.querySelectorAll(".longitude").forEach((function(t){t.value=e[0].geometry.location.lng().toFixed(7)})))}))}n=null,t=document.querySelector(".address"),void 0!==t&&null!=t&&t.addEventListener("keydown",(function(e){clearTimeout(n),n=setTimeout(a,1e3,e)}));let i=document.querySelector(".current-location");function r(e){var t=e.coords.latitude.toFixed(7),n=e.coords.longitude.toFixed(7);document.querySelectorAll(".latitude").forEach((function(e){e.value=t})),document.querySelectorAll(".longitude").forEach((function(e){e.value=n})),l()}null!=i&&(Main.isMobileDevice()&&navigator.geolocation?i.addEventListener("click",(e=>navigator.geolocation.getCurrentPosition(r))):i.classList.add("hide"))}))}},t={};function n(o){var l=t[o];if(void 0!==l)return l.exports;var a=t[o]={exports:{}};return e[o](a,a.exports,n),a.exports}(()=>{"use strict";n(298);let e,t=function(e){"undefined"!=typeof tinymce&&(tinymce.remove(),document.querySelectorAll(".entry-content .wp-editor-area").forEach((e=>{window.tinyMCE.execCommand("mceAddEditor",!1,e.id)}))),window.document.dispatchEvent(new Event("DOMContentLoaded",{bubbles:!0,cancelable:!0})),document.querySelectorAll(".wp-switch-editor").forEach((e=>e.addEventListener("click",(t=>{let n=e.closest(".wp-editor-wrap").querySelector(".wp-editor-area"),o=e.closest(".wp-editor-wrap").querySelector(".mce-panel");n.style.visibility="unset",t.target.matches(".switch-tmce")?(o.style.display="block",n.style.display="none"):(o.style.display="none",n.style.display="block")})))),document.querySelectorAll("select:not(.nonice,.swal2-select)").forEach((function(e){Main.attachNiceSelect(e)}));const t=new Event("scriptsloaded");e.dispatchEvent(t)},o=function(n){if(null==n)return;0==e.length&&t(n);let l=e.shift();if(null!=l)if("SCRIPT"==l.tagName&&null==document.getElementById(l.id)){var a=document.createElement("script");""==l.type?a.type="text/javascript":a.type=l.type,""!=l.src?a.src=l.src:a.innerHTML=l.innerHTML,a.id=l.id;try{document.head.appendChild(a)}catch(e){console.error(e)}e.length>0?""!=l.src?a.addEventListener("load",o.bind(null,n)):o(n):""!=l.src?a.addEventListener("load",t.bind(null,n)):t(n)}else e.length>0?o(n):t(n);else t(n)};async function l(e,t="delete"){let n,o=e.target;e.preventDefault(),parent=o.closest("#frontend-upload-form");let l={title:"Are you sure?",text:`Are you sure you want to ${t} this ${document.querySelector('[name="post-type"]').value}?`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:`Yes, ${t} it!`};if(null!=document.fullscreenElement&&(l.target=document.fullscreenElement),(await Swal.fire(l)).isConfirmed){let e=o.dataset.postId,l=o.innerHTML,r=l.split(" ")[0];r=r.substring(0,r.length-1)+"ing...",o.innerHTML=Main.showLoader(null,!1,20,r,!0,!0);var a=new FormData;a.append("post-id",e),n="delete"==t?"frontend_posting/remove_post":"frontend_posting/archive_post";var i=await FormSubmit.fetchRestApi(n,a);i&&Main.displayMessage(i),o.innerHTML=l}}async function a(){var e=document.querySelector('[name="post-id"]');if(null!=e&&""!=e.value){var t=new FormData;t.append("post-id",e.value),FormSubmit.fetchRestApi("frontend_posting/refresh_post_lock",t)}}function i(e){var t,n=document.getElementById("frontend-upload-form");t=null==e?location.search.replace("?type=",""):e.value,document.querySelector('#postform [name="post-type"]').value=t,n.querySelectorAll(".replace-post-type").forEach((function(e){e.textContent=t})),null!=tinymce.activeEditor&&""!=tinymce.activeEditor.getContent()||(n.querySelectorAll(".lite").forEach((function(e){e.classList.remove("hidden")})),n.querySelector("#show-all-fields").classList.add("hidden")),n.querySelectorAll("#wp-post-content-media-buttons, .advanced-publish-options, #advanced-publish-options-button").forEach((e=>e.classList.remove("hidden"))),n.querySelectorAll(`.property.${t}`).forEach((e=>e.classList.remove("hidden"))),n.querySelectorAll(`.property:not(.${t})`).forEach((e=>e.classList.add("hidden"))),"attachment"==t&&(n.querySelector('[name="signal-url"]').checked=!0)}async function r(t){tinymce.triggerSave(!0,!0);let n=await FormSubmit.submitForm(t,"frontend_posting/submit_post");if(n){if(!n.html||!n.js){let e=n.message||"Post submitted successfully. Reloading page...";return null!=n.data&&(e=e+" "+n.data),Main.displayMessage(e,"success"),void(location.href=n.url)}const t=new URL(n.url);window.history.pushState({},"",t);let l=document.getElementById("page-title-image");n.picture&&(null==l&&(l=document.createElement("div"),l.id="page-title-image"),l.style.backgroundImage=`url("${n.picture}")`),Main.hideModals(),document.querySelector("main").innerHTML=n.html,function(t,n){e=[];let l=document.createElement("div");l.innerHTML=t.html,e=Array.prototype.slice.call(l.getElementsByTagName("script")),t.js&&(l.innerHTML=t.js,e=[...l.children].concat(e),o(n)),t.css&&(l.innerHTML=t.css,[...l.children].forEach((e=>{document.head.appendChild(e)})))}(n,document),window.scrollTo(0,0),document.querySelector(".page-edit").classList.remove("hidden"),Main.displayMessage(n.message)}}function s(){setTimeout((function(){null!=wp.media.frame?wp.media.frame.on("insert",(function(){let e=wp.media.frame.state().get("selection").first().toJSON();if([".txt",".doc",".rtf"].some((t=>e.url.includes(t)))){let t={title:"Question",text:"Do you want to insert the contents of this file into the post?",icon:"question",showCancelButton:!0,confirmButtonColor:"#bd2919",cancelButtonColor:"#d33",confirmButtonText:"Yes please",cancelButtonText:"No thanks",hideClass:{popup:""}};null!=document.fullscreenElement&&(t.target=document.fullscreenElement);let n=Main.showLoader(null,!1,50,"",!0);Swal.fire(t).then((t=>{if(t.isConfirmed){let t={title:"Please wait...",html:n,showConfirmButton:!1,showClass:{backdrop:"swal2-noanimation",popup:"",icon:""}};null!=document.fullscreenElement&&(t.target=document.fullscreenElement),Swal.fire(t),async function(e){let t=new FormData;t.append("attachment-id",e);let n=await FormSubmit.fetchRestApi("frontend_posting/get_attachment_contents",t);if(n){let e=tinyMCE.activeEditor.getContent();tinymce.activeEditor.setContent(e+n),Swal.close()}}(e.id)}}))}})):s()}),100)}async function c(e){if(document.querySelectorAll("#post-title-warning").forEach((e=>e.remove())),""==e.value)return;let t=new FormData;t.append("title",e.value),t.append("type",e.closest("form").querySelector('[name="post-type"]').value),t.append("exclude",e.closest("form").querySelector('[name="post-id"]').value);let n=await FormSubmit.fetchRestApi("frontend_posting/check_duplicate",t);n&&(e.insertAdjacentHTML("afterEnd",n.html),Main.displayMessage(n.warning,"warning"))}console.log("Frontendposting.js loaded"),document.addEventListener("DOMContentLoaded",(function(){if(null==window.frontendLoaded){window.frontendLoaded=!0;let e=document.querySelector("#minutes");null!=e&&setInterval((function(){e.innerHTML=parseInt(e.innerHTML)+1}),6e4),a(),setInterval(a,6e4),(location.search.includes("?type")||location.search.includes("?post-id"))&&i(document.querySelector('#postform [name="post-type"]')),s()}})),window.onbeforeunload=function(){null==document.getElementById("post_lock_warning")&&async function(){var e=document.querySelector('[name="post-id"]');if(null!=e&&""!=e.value){var t=new FormData;t.append("post-id",e.value),await FormSubmit.fetchRestApi("frontend_posting/delete_post_lock",t)}}()},document.addEventListener("click",(e=>{let t=e.target;if("submit_post"==t.name||null!=t.parentNode&&"submit_post"==t.parentNode.name)r(t);else if("draft-post"==t.name||null!=t.parentNode&&"draft-post"==t.parentNode.name)t.closest("form").querySelector('[name="post-status"]').value="draft",r(t);else if("publish-post"==t.name)t.closest("form").querySelector('[name="post-status"]').value="publish",r(t);else if("delete-post"==t.name)l(e,"delete");else if("archive-post"==t.name)l(e,"archive");else if("change-post-type"==t.name)!async function(e){var t=await FormSubmit.submitForm(e,"frontend_posting/change_post_type");t&&Main.displayMessage(t)}(t);else if("add-featured-image"==t.name)!function(e){e.preventDefault();var t=e.target.closest("#frontend-upload-form");let n=wp.media.frames.file_frame=wp.media({title:"Select featured image",button:{text:"Save featured image"},multiple:!1});n.on("select",(function(){var e=n.state().get("selection").first().toJSON();t.querySelector('[name="post-image-id"]').value=e.id,document.getElementById("featured-image-div").classList.remove("hidden");var o=document.getElementById("featured-image-wrapper");null!=o.querySelector("img")&&o.querySelector("img").remove(),o.insertAdjacentHTML("beforeEnd",'<img width="150" height="150" src="'+e.url+'">'),t.querySelectorAll('[name="add-featured-image"]').forEach((function(e){e.innerHTML=e.innerHTML.replace("Add","Replace")}))})),n.open()}(e);else if("show-all-fields"==t.id)!function(e){var t=e.closest("#frontend-upload-form");t.querySelector("#show-all-fields").classList.contains("show")?(t.querySelectorAll(".lite").forEach((function(e){e.classList.remove("hidden")})),e.classList.remove("show"),e.classList.add("shouldhide"),e.textContent="Only show required fields"):(t.querySelectorAll(".lite").forEach((function(e){e.classList.add("hidden")})),e.classList.add("show"),e.classList.remove("shouldhide"),e.textContent="Show all fields")}(t);else if("advanced-publish-options-button"==t.id){let e=t.closest("form").querySelector(".advanced-publish-options");e.classList.contains("hidden")?(e.classList.remove("hidden"),t.querySelector("span").textContent="Hide"):(e.classList.add("hidden"),t.querySelector("span").textContent="Show")}else if(t.matches(".remove-featured-image")){document.querySelector('[name="post-image-id"]').value=0;let e=document.getElementById("featured-image-div");e.classList.add("hidden"),e.querySelector("img").remove(),document.querySelector('[name="add-featured-image"]').textContent="Add featured image"}else if(t.classList.contains("add-cat"))document.getElementById("add-"+t.dataset.type+"-type").classList.remove("hidden");else if(t.matches(".add-category .form-submit"))!async function(e){let t,n,o=await FormSubmit.submitForm(e,"frontend_posting/add_category");if(o){let l=e.closest("form").querySelector('[name="cat-parent"]').value,a=e.closest("form").querySelector('[name="post-type"]').value,i=e.closest("form").querySelector('[name="cat-name"]').value;if(""==l)t=document.getElementById(a+"_parenttypes"),n="";else{t=document.getElementById(a+"_childtypes"),n=`data-parent="${l}"`;let e=document.querySelector(`.${a}type[value="${l}"]`);e.checked||e.click()}let r=`\n\t\t<div class="info-box" ${n}>\n\t\t\t<input type="checkbox" class="${a}type" id="${a}type[]" value="${o.id}" checked>\n\t\t\t<label class="option-label category-select">${i}</label>\n\t\t</div>\n\t\t`;t.insertAdjacentHTML("afterBegin",r),Main.hideModals(),Main.displayMessage(`Succesfully added the ${i} category`)}}(t);else{if(!t.matches("button.show-diff"))return;t.parentNode.querySelector(".post-diff-wrapper").classList.toggle("hidden")}e.stopImmediatePropagation()})),document.addEventListener("change",(e=>{let t=e.target;if("post-type-selector"==t.id)i(t),""!=t.closest("#frontend-upload-form").querySelector('[name="post-title"]').value&&c(t.closest("#frontend-upload-form").querySelector('[name="post-title"]'));else if("post-title"==t.name)c(t);else if(null!=t.list){let e=t.list.querySelector(`[value='${t.value}' i]`);if(null!=e){let n=e.dataset.value,o=t.parentNode.querySelector(".datalistvalue");null!=o&&(o.value=n)}}else{if(!t.classList.contains("parent_cat"))return;!function(e){var t=e.closest(".info-box").dataset.parent,n=e.closest(".categories");e.checked?n.querySelectorAll("[data-parent='"+e.value+"']").forEach((e=>{e.classList.remove("hidden"),n.querySelector("#subcategorylabel").classList.remove("hidden")})):null==t&&null==n.querySelector('.childtypes input[type="checkbox"]:checked')&&(n.querySelector("#subcategorylabel").classList.add("hidden"),n.querySelectorAll("[data-parent='"+e.value+"']").forEach((e=>{e.classList.add("hidden")})))}(t)}e.stopImmediatePropagation()}))})()})();
//# sourceMappingURL=frontend_posting.min.js.map