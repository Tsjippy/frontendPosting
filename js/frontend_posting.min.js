(()=>{var __webpack_modules__={716:(e,t,o)=>{"use strict";let n;o.d(t,{se:()=>l});let a=function(e){"undefined"!=typeof tinymce&&(tinymce.remove(),document.querySelectorAll(".entry-content .wp-editor-area").forEach((e=>{window.tinyMCE.execCommand("mceAddEditor",!1,e.id)}))),window.document.dispatchEvent(new Event("DOMContentLoaded",{bubbles:!0,cancelable:!0})),document.querySelectorAll(".wp-switch-editor").forEach((e=>e.addEventListener("click",(t=>{let o=e.closest(".wp-editor-wrap").querySelector(".wp-editor-area"),n=e.closest(".wp-editor-wrap").querySelector(".mce-panel");o.style.visibility="unset",t.target.matches(".switch-tmce")?(n.style.display="block",o.style.display="none"):(n.style.display="none",o.style.display="block")})))),document.querySelectorAll("select:not(.nonice,.swal2-select)").forEach((function(e){null==e._niceselect&&(e._niceselect=NiceSelect.bind(e,{searchable:!0}))}));const t=new Event("scriptsloaded");e.dispatchEvent(t)},l=function(e,t){let o=document.createElement("div");e.js&&(o.innerHTML=e.js,n=[...o.children],s(t)),e.css&&(o.innerHTML=e.css,[...o.children].forEach((e=>{document.head.appendChild(e)})))},s=function(e){if(null==e)return;0==n.length&&a(e);let t=n.shift();if(null!=t)if("SCRIPT"==t.tagName&&null==document.getElementById(t.id)){var o=document.createElement("script");""==t.type?o.type="text/javascript":o.type=t.type,""!=t.src?o.src=t.src:o.innerHTML=t.innerHTML,o.id=t.id;try{document.head.appendChild(o)}catch(e){console.error(e)}n.length>0?""!=t.src?o.addEventListener("load",s.bind(null,e)):s(e):""!=t.src?o.addEventListener("load",a.bind(null,e)):a(e)}else n.length>0?s(e):a(e);else a(e)}},298:()=>{function e(e){var t=e.target,o=t.closest("form"),n=t.options[t.selectedIndex],a=n.value,l=n.text;"modal"==a?Main.showModal("add_location"):""!=l&&(o.querySelector("[name='location[address]']").value=l+" State",o.querySelector("[name='location[latitude]']").value=locations.locations[a].lat,o.querySelector("[name='location[longitude]']").value=locations.locations[a].lon)}console.log("Location.js loaded"),document.addEventListener("DOMContentLoaded",(function(){!function(){if(null==document.getElementById("googlemaps")&&"object"==typeof mapsApi&&"undefined"!=typeof initMap){const e=document.createElement("script");e.id="googlemaps",e.src=`//maps.googleapis.com/maps/api/js?key=${mapsApi.key}&callback=initMap`,e.async=!0,e.loading="async",document.body.append(e)}}();let t=document.querySelector('[name="location[preset]"]');void 0!==t&&null!=t&&t.addEventListener("change",e),t=document.querySelector(".latitude"),void 0!==t&&null!=t&&t.addEventListener("keydown",n),t=document.querySelector(".longitude"),void 0!==t&&null!=t&&t.addEventListener("keydown",n);var o=null;function n(){clearTimeout(o),o=setTimeout(a,1e3)}function a(){var e=document.querySelector(".latitude").value,t=document.querySelector(".longitude").value,o=new google.maps.Geocoder;if(""!=e&&""!=t){var n={lat:parseFloat(e),lng:parseFloat(t)};o.geocode({location:n},(function(e,t){"OK"===t&&e[0]&&document.querySelectorAll(".address").forEach((function(t){""==t.value&&(t.value=e[0].formatted_address)}))}))}}function l(e){var t=new google.maps.Geocoder,o=e.target.value;t.geocode({address:o},(function(e,t){"OK"===t&&(document.querySelectorAll(".latitude").forEach((function(t){t.value=e[0].geometry.location.lat().toFixed(7)})),document.querySelectorAll(".longitude").forEach((function(t){t.value=e[0].geometry.location.lng().toFixed(7)})))}))}o=null,t=document.querySelector(".address"),void 0!==t&&null!=t&&t.addEventListener("keydown",(function(e){clearTimeout(o),o=setTimeout(l,1e3,e)}));let s=document.querySelector(".current-location");function r(e){var t=e.coords.latitude.toFixed(7),o=e.coords.longitude.toFixed(7);document.querySelectorAll(".latitude").forEach((function(e){e.value=t})),document.querySelectorAll(".longitude").forEach((function(e){e.value=o})),a()}null!=s&&(Main.isMobileDevice()&&navigator.geolocation?s.addEventListener("click",(e=>navigator.geolocation.getCurrentPosition(r))):s.classList.add("hide"))}))}},__webpack_module_cache__={};function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var o=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e](o,o.exports,__webpack_require__),o.exports}__webpack_require__.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return __webpack_require__.d(t,{a:t}),t},__webpack_require__.d=(e,t)=>{for(var o in t)__webpack_require__.o(t,o)&&!__webpack_require__.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var __webpack_exports__={};(()=>{"use strict";var _locations_js_user_location_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(298),_locations_js_user_location_js__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_locations_js_user_location_js__WEBPACK_IMPORTED_MODULE_0__),_plugins_sim_plugin_includes_js_imports_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(716);async function confirmPostDelete(e,t="delete"){let o,n=e.target;e.preventDefault(),parent=n.closest("#frontend_upload_form");let a={title:"Are you sure?",text:`Are you sure you want to ${t} this ${document.querySelector('[name="post_type"]').value}}?`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:`Yes, ${t} it!`};if(null!=document.fullscreenElement&&(a.target=document.fullscreenElement),(await Swal.fire(a)).isConfirmed){let e=n.dataset.post_id;n.closest("div").querySelector(".loadergif").classList.remove("hidden");var l=new FormData;l.append("post_id",e),o="delete"==t?"frontend_posting/remove_post":"frontend_posting/archive_post";var s=await FormSubmit.fetchRestApi(o,l);s&&Main.displayMessage(s)}}async function refreshPostLock(){var e=document.querySelector('[name="post_id"]');if(null!=e&&""!=e.value){var t=new FormData;t.append("postid",e.value),FormSubmit.fetchRestApi("frontend_posting/refresh_post_lock",t)}}async function deletePostLock(){var e=document.querySelector('[name="post_id"]');if(null!=e&&""!=e.value){var t=new FormData;t.append("postid",e.value),await FormSubmit.fetchRestApi("frontend_posting/delete_post_lock",t)}}async function changePostType(e){var t=await FormSubmit.submitForm(e,"frontend_posting/change_post_type");t&&Main.displayMessage(t)}function switchforms(e){var t,o=document.getElementById("frontend_upload_form");t=null==e?location.search.replace("?type=",""):e.value,document.querySelector('#postform [name="post_type"]').value=t,o.querySelectorAll(".replaceposttype").forEach((function(e){e.textContent=t})),null!=tinymce.activeEditor&&""!=tinymce.activeEditor.getContent()||(o.querySelectorAll(".lite").forEach((function(e){e.classList.remove("hidden")})),o.querySelector("#showallfields").classList.add("hidden")),o.querySelectorAll("#wp-post_content-media-buttons, .advancedpublishoptions, #advancedpublishoptionsbutton").forEach((e=>e.classList.remove("hidden"))),o.querySelectorAll(`.property.${t}`).forEach((e=>e.classList.remove("hidden"))),o.querySelectorAll(`.property:not(.${t})`).forEach((e=>e.classList.add("hidden"))),"attachment"==t&&(o.querySelector('[name="signal_url"]').checked=!0)}function showallfields(e){var t=e.closest("#frontend_upload_form");t.querySelector("#showallfields").classList.contains("show")?(t.querySelectorAll(".lite").forEach((function(e){e.classList.remove("hidden")})),e.classList.remove("show"),e.classList.add("shouldhide"),e.textContent="Only show required fields"):(t.querySelectorAll(".lite").forEach((function(e){e.classList.add("hidden")})),e.classList.add("show"),e.classList.remove("shouldhide"),e.textContent="Show all fields")}function addFeaturedImage(e){e.preventDefault();var t=e.target.closest("#frontend_upload_form");let o=wp.media.frames.file_frame=wp.media({title:"Select featured image",button:{text:"Save featured image"},multiple:!1});o.on("select",(function(){var e=o.state().get("selection").first().toJSON();t.querySelector('[name="post_image_id"]').value=e.id,document.getElementById("featured-image-div").classList.remove("hidden");var n=document.getElementById("featured_image_wrapper");null!=n.querySelector("img")&&n.querySelector("img").remove(),n.insertAdjacentHTML("beforeEnd",'<img width="150" height="150" src="'+e.url+'">'),t.querySelectorAll('[name="add-featured-image"]').forEach((function(e){e.innerHTML=e.innerHTML.replace("Add","Replace")}))})),o.open()}function catChanged(e){var t=e.closest(".infobox").dataset.parent,o=e.closest(".categories");e.checked?o.querySelectorAll("[data-parent='"+e.value+"']").forEach((e=>{e.classList.remove("hidden"),o.querySelector("#subcategorylabel").classList.remove("hidden")})):null==t&&null==o.querySelector('.childtypes input[type="checkbox"]:checked')&&(o.querySelector("#subcategorylabel").classList.add("hidden"),o.querySelectorAll("[data-parent='"+e.value+"']").forEach((e=>{e.classList.add("hidden")})))}async function addCatType(e){let t,o,n=await FormSubmit.submitForm(e,"frontend_posting/add_category");if(n){let a=e.closest("form").querySelector('[name="cat_parent"]').value,l=e.closest("form").querySelector('[name="post_type"]').value,s=e.closest("form").querySelector('[name="cat_name"]').value;if(""==a)t=document.getElementById(l+"_parenttypes"),o="";else{t=document.getElementById(l+"_childtypes"),o=`data-parent="${a}"`;let e=document.querySelector(`.${l}type[value="${a}"]`);e.checked||e.click()}let r=`\n\t\t<div class="infobox" ${o}>\n\t\t\t<input type="checkbox" class="${l}type" id="${l}type[]" value="${n.id}" checked>\n\t\t\t<label class="option-label category-select">${s}</label>\n\t\t</div>\n\t\t`;t.insertAdjacentHTML("afterBegin",r),Main.hideModals(),Main.displayMessage(`Succesfully added the ${s} category`)}}async function submitPost(target){let response=await FormSubmit.submitForm(target,"frontend_posting/submit_post");if(response){if(!response.html||!response.js)return Main.displayMessage(response.message+response.data),void(location.href=response.url);const url=new URL(response.url);window.history.pushState({},"",url);let div=document.getElementById("page-title-image");response.picture&&(null==div&&(div=document.createElement("div"),div.id="page-title-image"),div.style.backgroundImage=`url("${response.picture}")`),document.querySelector("main").innerHTML=response.html;let scripts=document.querySelector("main").getElementsByTagName("script");for(let n=0;n<scripts.length;n++)eval(scripts[n].innerHTML);(0,_plugins_sim_plugin_includes_js_imports_js__WEBPACK_IMPORTED_MODULE_1__.se)(response,document),window.scrollTo(0,0),console.log("scrolling"),document.getElementById("page-edit").classList.remove("hidden"),Main.displayMessage(response.message)}}async function readFileContents(e){let t=new FormData;t.append("attachment_id",e);let o=await FormSubmit.fetchRestApi("frontend_posting/get_attachment_contents",t);if(o){let e=tinyMCE.activeEditor.getContent();tinymce.activeEditor.setContent(e+o),Swal.close()}}function insertMediaContents(){setTimeout((function(){null!=wp.media.frame?wp.media.frame.on("insert",(function(){let e=wp.media.frame.state().get("selection").first().toJSON();if([".txt",".doc",".rtf"].some((t=>e.url.includes(t)))){let t={title:"Question",text:"Do you want to insert the contents of this file into the post?",icon:"question",showCancelButton:!0,confirmButtonColor:"#bd2919",cancelButtonColor:"#d33",confirmButtonText:"Yes please",cancelButtonText:"No thanks",hideClass:{popup:""}};null!=document.fullscreenElement&&(t.target=document.fullscreenElement),Swal.fire(t).then((t=>{if(t.isConfirmed){let t={title:"Please wait...",html:"<IMG src='"+sim.loadingGif+"' width=100 height=100>",showConfirmButton:!1,showClass:{backdrop:"swal2-noanimation",popup:"",icon:""}};null!=document.fullscreenElement&&(t.target=document.fullscreenElement),Swal.fire(t),readFileContents(e.id)}}))}})):insertMediaContents()}),100)}async function checkForDuplicate(e){if(document.querySelectorAll("#post-title-warning").forEach((e=>e.remove())),""==e.value)return;let t=new FormData;t.append("title",e.value),t.append("type",e.closest("form").querySelector('[name="post_type"]').value),t.append("exclude",e.closest("form").querySelector('[name="post_id"]').value);let o=await FormSubmit.fetchRestApi("frontend_posting/check_duplicate",t);o&&(e.insertAdjacentHTML("afterEnd",o.html),Main.displayMessage(o.warning,"warning"))}console.log("Frontendposting.js loaded"),document.addEventListener("DOMContentLoaded",(function(){if(null==window.frontendLoaded){window.frontendLoaded=!0;let e=document.querySelector("#minutes");null!=e&&setInterval((function(){e.innerHTML=parseInt(e.innerHTML)+1}),6e4),refreshPostLock(),setInterval(refreshPostLock,6e4),(location.search.includes("?type")||location.search.includes("?post_id"))&&switchforms(document.querySelector('#postform [name="post_type"]')),insertMediaContents()}})),window.onbeforeunload=function(){null==document.getElementById("post_lock_warning")&&deletePostLock()},document.addEventListener("click",(e=>{let t=e.target;if("submit_post"==t.name||null!=t.parentNode&&"submit_post"==t.parentNode.name)submitPost(t);else if("draft_post"==t.name||null!=t.parentNode&&"draft_post"==t.parentNode.name)t.closest("form").querySelector('[name="post_status"]').value="draft",submitPost(t);else if("publish_post"==t.name)t.closest("form").querySelector('[name="post_status"]').value="publish",submitPost(t);else if("delete_post"==t.name)confirmPostDelete(e,"delete");else if("archive_post"==t.name)confirmPostDelete(e,"archive");else if("change_post_type"==t.name)changePostType(t);else if("add-featured-image"==t.name)addFeaturedImage(e);else if("showallfields"==t.id)showallfields(t);else if("advancedpublishoptionsbutton"==t.id){let e=t.closest("form").querySelector(".advancedpublishoptions");e.classList.contains("hidden")?(e.classList.remove("hidden"),t.querySelector("span").textContent="Hide"):(e.classList.add("hidden"),t.querySelector("span").textContent="Show")}if(t.matches(".remove_featured_image")){document.querySelector('[name="post_image_id"]').value=0;let e=document.getElementById("featured-image-div");e.classList.add("hidden"),e.querySelector("img").remove(),document.querySelector('[name="add-featured-image"]').textContent="Add featured image"}t.classList.contains("add_cat")&&document.getElementById("add_"+t.dataset.type+"_type").classList.remove("hidden"),t.matches(".add_category .form_submit")&&addCatType(t),t.matches("button.show-diff")&&t.parentNode.querySelector(".post-diff-wrapper").classList.toggle("hidden")})),document.addEventListener("change",(e=>{let t=e.target;if("post_type_selector"==t.id?(switchforms(t),""!=t.closest("#frontend_upload_form").querySelector('[name="post_title"]').value&&checkForDuplicate(t.closest("#frontend_upload_form").querySelector('[name="post_title"]'))):"post_title"==t.name&&checkForDuplicate(t),null!=t.list){let e=t.list.querySelector(`[value='${t.value}' i]`);if(null!=e){let o=e.dataset.value,n=t.parentNode.querySelector(".datalistvalue");null!=n&&(n.value=o)}}t.classList.contains("parent_cat")&&catChanged(t)}))})()})();
//# sourceMappingURL=frontend_posting.min.js.map